# -*- coding: utf-8 -*-
"""Netflix EDA.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1cg3erk8hp2MtToygz0ZlTgolu8ab4b26

### Analysis on Netflix Movies and TV Show
"""

# Commented out IPython magic to ensure Python compatibility.
import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
import seaborn as sns
# %matplotlib inline

"""Loading the Dataset"""

netflix_titles_df = pd.read_csv('/content/netflix_titles.csv.zip')
netflix_titles_df.head()

"""Data Preparation and Cleaning"""

netflix_titles_df.info()

"""Here are 6,234 entries and 12 columns to work with for EDA. And few columns also contain null values."""

netflix_titles_df.nunique()

"""### Handling Null Values"""

netflix_titles_df.isnull().values.any()

netflix_titles_df.isnull().sum().sum()

sns.heatmap(netflix_titles_df.isnull(), cbar=False)
plt.title('Null Values Heatmap')
plt.show()

netflix_titles_df.isnull().sum()

"""From the above heatmap and table, we could comprehend that, there are quiet a few null values present in the data"""

netflix_titles_df['director'].fillna('No Director', inplace=True)
netflix_titles_df['cast'].fillna('No Cast', inplace=True)
netflix_titles_df['country'].fillna('Country Unavailable', inplace=True)
netflix_titles_df.dropna(subset=['date_added','rating'],inplace=True)

netflix_titles_df.isnull().any()

"""For null values, I could just simply consider deleting those rows, but this may result in loss of information. So, currently we're treating each missing value as unavailable

###Spliting the Dataset
Since the dataset can either contain movies or shows, it'd be nice to have datasets for both
"""

netflix_movies_df = netflix_titles_df[netflix_titles_df['type']=='Movie'].copy()
netflix_movies_df.head()

netflix_shows_df = netflix_titles_df[netflix_titles_df['type']=='TV Show'].copy()
netflix_shows_df.head()

"""###Data Preparation
Movies are based on the duration of the movie and shows are based on the number of seasons. To make EDA easier, I will convert the values in these columns into integers for both the movies and shows datasets.
"""

netflix_movies_df.duration = netflix_movies_df.duration.str.replace(' min','').astype(int)
netflix_shows_df.rename(columns={'duration':'seasons'}, inplace=True)
netflix_shows_df.replace({'seasons':{'1 Season':'1 Seasons'}}, inplace=True)
netflix_shows_df.seasons = netflix_shows_df.seasons.str.replace(' Seasons','').astype(int)

"""###Data Analysation"""

netflix_titles_df.head()

plt.figure(figsize=(12,6))
plt.title("% of Netflix Titles that are either Movies or TV Shows")
g = plt.pie(netflix_titles_df.type.value_counts(), explode=(0.025,0.025), labels=netflix_titles_df.type.value_counts().index, colors=['skyblue','navajowhite'],autopct='%1.1f%%', startangle=180);
plt.legend()
plt.show()

order =  ['G', 'TV-Y', 'TV-G', 'PG', 'TV-Y7', 'TV-Y7-FV', 'TV-PG', 'PG-13', 'TV-14', 'R', 'NC-17', 'TV-MA']
plt.figure(figsize=(15,7))
g = sns.countplot(x='rating', hue='type', data=netflix_titles_df, order=order, palette="pastel");
plt.title("Ratings for Movies & TV Shows")
plt.xlabel("Rating")
plt.ylabel("Total Count")
plt.show()

fig, ax = plt.subplots(1,2, figsize=(19, 5))
g1 = sns.countplot(x='rating', data=netflix_movies_df, order=order[::-1], palette="Set2", ax=ax[0], legend=False);
g1.set_title("Ratings for Movies")
g1.set_xlabel("Rating")
g1.set_ylabel("Total Count")
g2 = sns.countplot(x='rating', data=netflix_shows_df, order=order, palette="Set2", ax=ax[1], legend=False);
g2.set(yticks=np.arange(0,1600,200))
g2.set_title("Ratings for TV Shows")
g2.set_xlabel("Rating")
g2.set_ylabel("Total Count")
fig.show()

netflix_titles_df['year_added'] = pd.DatetimeIndex(netflix_titles_df['date_added']).year
netflix_movies_df['year_added'] = pd.DatetimeIndex(netflix_movies_df['date_added']).year
netflix_shows_df['year_added'] = pd.DatetimeIndex(netflix_shows_df['date_added']).year
netflix_titles_df['month_added'] = pd.DatetimeIndex(netflix_titles_df['date_added']).month
netflix_movies_df['month_added'] = pd.DatetimeIndex(netflix_movies_df['date_added']).month
netflix_shows_df['month_added'] = pd.DatetimeIndex(netflix_shows_df['date_added']).month

temp_df = netflix_titles_df['year_added'].value_counts().reset_index()
temp_df.columns = ['year', 'count']
netflix_year = temp_df[temp_df['year'] != 2020]
netflix_year

netflix_year2 = netflix_titles_df[['type','year_added']]
movie_year_counts = netflix_year2[netflix_year2['type']=='Movie'].year_added.value_counts().reset_index()
movie_year_counts.columns = ['year', 'count']
movie_year = movie_year_counts[movie_year_counts['year'] != 2020]
show_year_counts = netflix_year2[netflix_year2['type']=='TV Show'].year_added.value_counts().reset_index()
show_year_counts.columns = ['year', 'count']
show_year = show_year_counts[show_year_counts['year'] != 2020]

movie_year

show_year

fig, ax = plt.subplots(figsize=(10, 6))
sns.lineplot(data=netflix_year, x='year', y='count')
sns.lineplot(data=movie_year, x='year', y='count')
sns.lineplot(data=show_year, x='year', y='count')
ax.set_xticks(np.arange(2008, 2020, 1))
plt.title("Total content added each year (up to 2019)")
plt.legend(['Total','Movie','TV Show'])
plt.ylabel("Releases")
plt.xlabel("Year")

month_year_df = netflix_titles_df.groupby('year_added')['month_added'].value_counts().unstack().fillna(0).T

plt.figure(figsize=(11,8))
sns.heatmap(month_year_df, linewidths=0.025, cmap="YlGnBu")
plt.title("Content Heatmap")
plt.ylabel("Month")
plt.xlabel("Year")
plt.show()

fig, ax = plt.subplots(1,2, figsize=(19, 5))
g1 = sns.distplot(netflix_movies_df.duration, color='skyblue',ax=ax[0]);
g1.set_xticks(np.arange(0,360,30))
g1.set_title("Duration Distribution for Netflix Movies")
g1.set_ylabel("% of All Netflix Movies")
g1.set_xlabel("Duration (minutes)")
g2 = sns.countplot(netflix_shows_df.seasons, color='skyblue',ax=ax[1]);
g2.set_title("Netflix TV Shows Seasons")
g2.set_ylabel("Count")
g2.set_xlabel("Season(s)")
fig.show()

filtered_countries = netflix_titles_df.set_index('title').country.str.split(', ', expand=True).stack().reset_index(level=1, drop=True);
filtered_countries = filtered_countries[filtered_countries != 'Country Unavailable']
filtered_countries = filtered_countries.reset_index(drop=True)
plt.figure(figsize=(7,9))
g = sns.countplot(y = filtered_countries, order=filtered_countries.value_counts().index[:20])
plt.title('Top 20 Countries on Netflix')
plt.xlabel('Titles')
plt.ylabel('Country')
plt.show()

filtered_genres = netflix_titles_df.set_index('title').listed_in.str.split(', ', expand=True).stack().reset_index(level=1, drop=True);
filtered_genres = filtered_genres.reset_index(drop=True)
plt.figure(figsize=(7,9))
g = sns.countplot(y = filtered_genres, order=filtered_genres.value_counts().index[:20])1
plt.title('Top 20 Genres on Netflix')
plt.xlabel('Titles')
plt.ylabel('Genres')
plt.show()

